<!DOCTYPE html>
<html lang="en" ng-app="itpmReportApp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>iTPM Calendar Report</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src=${urlObj.itpm_jquery}></script>
	<script src=${urlObj.itpm_angular}></script>
	<script src=${urlObj.itpm_angular_bootstrap}></script>
	<script src=${urlObj.itpm_angular_bootstrap_tpls}></script>
	<script src=${urlObj.itpm_angular_draggable}></script>	
	<style>
		body {
	    	padding: 25px;
    		box-sizing: border-box;
		}
	
		.CalViewReport {
		    margin: 0 auto;
		    background: #FFF;
		    font-family: Arial, Helvetica, sans-serif;
		    /* height:500px;
		    overflow-y:scroll; */
		}
		.CalViewReport::after{
			content:'';
			display:table;
			clear:both;
		}
		.DataTable,
		.DataCal {
		    float: left;
		    margin: 0;
		    padding: 0;
		}
		
		.DataTable {
		    width: 69.5%;		 
		}
		
		.DataCal {
		    width: 30%;
		}
		
		.CalDataTable thead tr th {
		    text-align: left;
		}
		
		@media screen and (max-width: 1024px) {
		    .DataTable {
		        width: 69%;
		    }
		    .DataCal {
		        width: 30%;
		    }
		}
		
		.CalDataTable,
		.CalTable {
		    border: 1px solid #a9b1b4;
		    border-bottom: none;
		}
		
		.CalTable {
		    border-left: none;
		    border-right: none;
		}
		
		.CalDataTable {
		    border-right: none;
		    width: 100%;
		}
		
		.DataCal {
		    border-right: 1px solid #a9b1b4;
		}
		
		.DataCal,
		CalTable {
		    overflow-x: scroll;
		}
		
		.CalDataTable thead tr,
		.CalTable thead tr {
		    background: #e5e5e5;
		}
		
		.CalDataTable thead tr th {
		    font-size: 12px;
		    font-weight: 700;
		    padding: 5px;
		    border-bottom: 1px solid #000;
		}
		
		.CalDataTable thead tr th.nobrd {
		    border-bottom: 1px solid transparent;
		}
		
		.CalTable thead tr th {
		    font-size: 12px;
		    font-weight: 700;
		    padding: 5px;
		    border-bottom: 1px solid #000;
		}
		
		.CalDataTable tbody tr td,
		.CalTable tbody tr td {
		    font-size: 13px;
		    padding: 0;
		    border-bottom: 1px solid #a9b1b4;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    white-space: nowrap;
		    max-width: auto;
		}
		
		.CalDataTable tbody tr td:nth-child(2),
		.CalDataTable tbody tr td:nth-child(3),
		.CalDataTable tbody tr td:nth-child(4) {
		    max-width: 100px;
		}
		
		.CalDataTable thead tr th,
		.CalDataTable tbody tr td {
		    border-right: 1px solid #a9b1b4;
		}
		
		.CalDataTable thead tr th:not(:first-child),
		.CalDataTable tbody tr td:not(:first-child) {
		    padding: 5px;
		}
		
		.CalDataTable thead tr th:first-child,
		.CalDataTable tbody tr td:first-child {
		    padding-left: 5px;
		}
		
		.CalTable thead tr th,
		.CalTable tbody tr td {
		    border-left: 1px dashed #607b86;
		}
		
		.CalWeekDaysHeader {
		    margin: 0;
		    padding: 0;
		}
		
		.CalTable table.CalWeekDaysHeader tr td {
		    border-bottom: none !important;
		    font-size: 12px !important;
		    font-weight: 500;
		    text-align: center;
		    padding: 0;
		}
		
		.DataCalBody tr td {
		    border-bottom: none !important;
		    font-size: 13px !important;
		    font-weight: 500;
		    width: 28px;
		    text-align: center;
		    padding: 5px;
		}
		
		.CalTable table.CalWeekDaysHeader tr td:not(:last-child) {
		    border-right: 1px solid #a9b1b4;
		}
		
		.CalTable table.CalWeekDaysHeader tr td,
		.DataCalBody tr td {
		    border-left: none !important;
		}
		
		.CalTr2 th {
		    padding: 0 !important;
		}
		
		.DataCalBody {
		    margin: 0;
		    padding: 0;
		}
		
		
		/* .DataCalBody tbody tr td {
		    width: 25px !important;
		    padding: 5px;
		} */
		
		.DataCalBody tr td:not(:last-child) {
		    border-right: 1px solid #a9b1b4;
		}
		
		.CalWeekDaysHeader tr td p {
		    display: inline-block;
		    width: 25px;
		    padding: 5px 0;
		    margin: 0
		}
		
		.DataCalBody tr td p {
		    width: 25px;
		    padding: 5px;
		    margin: 0;
		    box-sizing: border-box;
		    user-select:none;
		    -webkit-user-select:none;
		    -moz-user-select:none;
		    -ms-user-select:none;
		}
		
		.CalTable thead tr th:first-child,
		.CalTable tbody tr td:first-child {
		    border-left: none;
		}
		
		
		/*********** 
		Status Colors
		************/
		
		.status-blue {
		    background: #1E88E5;
		}
		
		.status-yellow {
		    background: #FFDE03;
		}
		
		.status-red {
		    background: #FF3D00;
		}
		
		.status-green {
		    background: #7CB342;
		}
		
		.status-orange {
		    background: #FB8C00;
		}
		
		.ReportInfoMsg ul {
		    float: right;
		    margin-right: 1%;
		    ;
		}
		
		.ReportInfoMsg::after {
		    content: '';
		    display: table;
		    clear: both;
		}
		
		.ReportInfoMsg ul li {
		    display: inline-block;
		    list-style-type: none;
		    padding: 6px 12px;
		    color: #000;
		    font-size: 12px;
		    border-radius: 2px;
		}
		
		.ReportInfoMsg ul li.red {
		    background: #FF3D00;
		}
		
		.ReportInfoMsg ul li.blue {
		    background: #1E88E5;
		}
		
		.ReportInfoMsg ul li.green {
		    background: #7CB342;
		}
		
		.ReportInfoMsg ul li.orange {
		    background: #FB8C00;
		}
		
		.ReportInfoMsg ul li.yellow {
		    background: #FFDE03;
		}
	</style>
</head>

<body ng-controller="itpmReportCtrl">
	<center><h4 ng-if="loading"><b>Loading iTPM Report....</b></h4></center>
    <div class="ReportInfoMsg" ng-if="!loading" ng-cloak>
    		<!-- <div style="clear:both;font-size:22px;color:#4d5f79;padding-bottom:15px;font-weight:bold;">iTPM Calendar Report</div> -->
            <span style="font-weight:bold;color:#6f6f6f;font-size:16px;">Date/Time?</span>
            <ul>
                <li class="orange">Draft</li>
                <li class="yellow">Submitted</li>
                <li class="green">Approved</li>
                <li class="red">Rejected/Voided</li>
                <li class="blue">Closed</li>
            </ul>
        </div>
        <br/>
    <div class="CalViewReport" id="CalTableHeight" ng-if="!loading" ng-cloak>
    	  
        <div class="DataTable" ng-init="setTableHeight()">
            <table cellpadding="0" cellspacing="0" border="0" class="CalDataTable">
                <thead>
                    <tr>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                        <th class="nobrd">&nbsp;</th>
                    </tr>
                    <tr>
                        <th>Customer</th>
                        <th>Item <br>Description</th>
                        <th>Promotion <br>Type</th>
                        <th>Promotion <br>Description</th>
                        <th>ID</th>
                        <th>Start Ship</th>
                        <th>End Ship</th>
                        <th>UOM</th>
                        <th>MOP</th>
                        <th>%</th>
                        <th>Rate</th>
                    </tr>
                </thead>
                <tbody>
                	<tr ng-if="promo_data.length <= 0">
                        <td colspan="50" height="32px"><b>No Records Found.</b></td>
                    </tr>
                	<tr ng-repeat="data in promo_data track by $index">
                        <td>{{data.entity}}</td>
                        <td>{{data.item_desc.split('').splice(0,12).join('')}}</td>
                        <td title="{{data.promo_type}}">{{data.promo_type}}</td>
                        <td>{{data.promo_desc.split('').splice(0,12).join('')}}</td>
                        <td><a href="/app/common/custom/custrecordentry.nl?rectype={{data.promo_rec_type}}&id={{data.promo_id}}">{{data.promo_id}}</a></td>
                        <td>{{data.ship_startdate}}</td>
                        <td>{{data.ship_enddate}}</td>
                        <td>{{data.uom}}</td>
                        <td>{{data.mop}}</td>
                        <td>{{data.percent_peruom}}</td>
                        <td>{{data.rate_peruom}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="DataCal" id="CalTableScroll" ng-mouseup="mouseUp()" ng-mousedown="mouseDown($event)" ng-mousemove="mouseMove($event)">
            <table cellpadding="0" cellspacing="0" border="0" class="CalTable">
                <thead>
                    <tr>
                    	<th ng-repeat="month in months track by $index" ng-if="startMonth <= month.id && month.id <= endMonth"><br>{{month.name}}</th>
                    </tr>
                    <tr class="CalTr2">
                    	 <th ng-repeat="month in months track by $index" ng-if="startMonth <= month.id && month.id <= endMonth">
                            <table class="CalWeekDaysHeader" cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td ng-repeat="obj in weeks track by $index" ng-if="obj.month == month.id">
                                        <p>{{obj.date}}</p>
                                    </td>
                                </tr>
                            </table>
                        </th>
                    </tr>
                </thead>
                <tbody>
                	<tr ng-if="promo_data.length <= 0">
                        <td colspan="50" height="32px">&nbsp;</td>
                    </tr>
                    <tr ng-repeat="promo_data in promo_data track by $index">
                        <td ng-repeat="month in months track by $index" ng-if="startMonth <= month.id && month.id <= endMonth">
                            <table class="DataCalBody" cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td ng-repeat="obj in weeks track by $index" ng-if="obj.month == month.id">
                                        <p class="{{(promo_data.sweek <= obj.week && obj.week <= promo_data.eweek)?promo_data.promo_status:''}}">&nbsp;</p>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
<script type="text/javascript">
	angular.module('itpmReportApp',['Dragtable']).controller('itpmReportCtrl',function($scope){
		$scope.loading = true;
		$scope.promo_data = ${promotionData.list};
		$scope.weeks = ${weeks.list};
		$scope.startMonth = ${datesObj.startMonth};
		$scope.endMonth = ${datesObj.endMonth};
		$scope.months = [{id:0,name:"January"},
		                 {id:1,name:"February"},
		                 {id:2,name:"March"},
		                 {id:3,name:"April"},
		                 {id:4,name:"May"},
		                 {id:5,name:"June"},
		                 {id:6,name:"July"},
		                 {id:7,name:"August"},
		                 {id:8,name:"September"},
		                 {id:9,name:"October"},
		                 {id:10,name:"November"},
		                 {id:11,name:"December"}];
		console.log($scope.startMonth,$scope.endMonth);
		$scope.loading = false;
		
		var down=false;
		var scrollLeft=0;
		var x = 0;
		
		$scope.mouseDown = function(e){
			 down = true;
			 scrollLeft = document.getElementById('CalTableScroll').scrollLeft;
			 x = e.clientX;
		}
		$scope.mouseUp = function(){
			down = false;
		}
		$scope.mouseMove = function(e){
			 if (down) {
				 document.getElementById('CalTableScroll').scrollLeft = scrollLeft + x - e.clientX;
			 }
		}
		$scope.setTableHeight = function(){
			document.getElementById('CalTableHeight').scrollHeight = document.getElementById('CalTableHeight').scrollHeight + 50;
		}
		
	});
	
	
	</script>

</html>